/*
 * This file is part of the CN24 semantic segmentation software,
 * copyright (C) 2015 Clemens-Alexander Brust (ikosa dot de at gmail dot com).
 *
 * For licensing information, see the LICENSE file included with this project.
 */
/**
 * @file rbfExample.cpp
 * @brief Tests the gradient in a simple net with only an RBFLayer.
 *
 * @author Clemens-Alexander Brust(ikosa dot de at gmail dot com)
 */

#include <iostream>
#include <fstream>
#include <sstream>
#include <string>
#include <vector>
#include <iomanip>
#include <ctime>
#include <cstring>
#include <random>
#include <algorithm>

#include <cn24.h>

int main (int argc, char* argv[]) {
  Conv::System::Init();

  // Create input data tensors
  const unsigned int WIDTH = 100;
  const unsigned int HEIGHT = 100;
  const unsigned int INPUT_MAPS = 1;
  const unsigned int OUTPUT_MAPS = 1;

  Conv::Tensor* data_tensor = new Conv::Tensor (1, WIDTH, HEIGHT, INPUT_MAPS);
  Conv::Tensor* weight_tensor = new Conv::Tensor (1, WIDTH, HEIGHT, 1);
  Conv::Tensor* label_tensor = new Conv::Tensor (1, WIDTH, HEIGHT, OUTPUT_MAPS);
  Conv::Tensor* helper_tensor = new Conv::Tensor (1, WIDTH, HEIGHT, 2);

  // Initialize constant value tensors
  helper_tensor->Clear();
  weight_tensor->Clear (1);

  // Fill data and label tensors with randomness
  std::mt19937 generator (39392);
  std::uniform_real_distribution< Conv::datum > distribution (-1.0, 1.0);

  for (unsigned int e = 0; e < data_tensor->elements(); e++)
    (*data_tensor) [e] = distribution (generator);

  for (unsigned int e = 0; e < label_tensor->elements(); e++)
    (*label_tensor) [e] = distribution (generator);

  // Assemble net
  Conv::Net net;
  Conv::InputLayer* input_layer = new Conv::InputLayer (*data_tensor, *label_tensor, *helper_tensor, *weight_tensor);
  const int data_layer_id = net.AddLayer (input_layer);

  // Add RBFLayer
  Conv::RBFLayer rbf_layer;
  const int output_layer_id = net.AddLayer (&rbf_layer, data_layer_id);

  // Add ErrorLayer
  Conv::ErrorLayer error_layer;
  net.AddLayer (&error_layer, {
    Conv::Connection (output_layer_id),
    Conv::Connection (data_layer_id, 1),
    Conv::Connection (data_layer_id, 3)
  });

  Conv::GradientTester::TestGradient (net);

  LOGEND;
  return 0;
}










































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































